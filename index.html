<!DOCTYPE html>
<html lang="bg">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°–æ—Ü–∏–∞–ª–µ–Ω –∫–æ–º–ø–∞—Å: –†–æ–±–∏–Ω–∑–æ–Ω –ö—Ä—É–∑–æ –∏ AI</title>
    
    <!-- PWA Settings -->
    <link rel="manifest" href="manifest.webmanifest">
    
    <!-- Favicon (Browser Tab) -->
    <link rel="icon" type="image/svg+xml" href="icon.svg">
    
    <!-- iOS / Apple Touch Icon (Home Screen) -->
    <link rel="apple-touch-icon" href="icon-192.png">

    <meta name="theme-color" content="#22c55e">
    <meta name="description" content="–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞ –±–∞–ª–∞–Ω—Å –º–µ–∂–¥—É –¥–∏–≥–∏—Ç–∞–ª–Ω–∏—è –∏ —Ä–µ–∞–ª–Ω–∏—è —Å–≤—è—Ç.">

    <!-- Styles & Fonts -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">

    <style>
        body { 
            font-family: 'Roboto', sans-serif; 
            user-select: none;
            margin: 0;
            overflow: hidden;
            background-color: #333;
        }

        /* --- REALISTIC BACKGROUND SCENE --- */
        .scene-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            background: linear-gradient(to bottom, #4facfe 0%, #00f2fe 50%, #43e97b 100%);
        }

        /* 1. SKY & SUN */
        .sky {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 60%;
            background: linear-gradient(180deg, #0ea5e9 0%, #38bdf8 60%, #bae6fd 100%);
            overflow: hidden;
        }
        
        .sun {
            position: absolute;
            top: 15%;
            right: 15%;
            width: 80px;
            height: 80px;
            background: radial-gradient(circle, #fefce8 40%, #fde047 70%, rgba(253, 224, 71, 0) 100%);
            border-radius: 50%;
            box-shadow: 0 0 40px 10px rgba(253, 224, 71, 0.4);
            animation: sun-glow 4s infinite alternate;
        }

        @keyframes sun-glow {
            from { opacity: 0.8; transform: scale(1); }
            to { opacity: 1; transform: scale(1.1); }
        }

        .cloud {
            position: absolute;
            background: rgba(255, 255, 255, 0.6);
            border-radius: 50px;
            filter: blur(8px);
            animation: cloud-move 60s linear infinite;
        }
        .cloud::after {
            content: '';
            position: absolute;
            top: -10px;
            left: 10px;
            width: 60%;
            height: 150%;
            background: inherit;
            border-radius: 50%;
        }

        @keyframes cloud-move {
            from { transform: translateX(-200px); }
            to { transform: translateX(120vw); }
        }

        /* 2. OCEAN */
        .sea {
            position: absolute;
            top: 55%;
            left: 0;
            width: 100%;
            height: 25%;
            background: linear-gradient(180deg, #0f766e 0%, #2dd4bf 40%, #99f6e4 90%, rgba(255,255,255,0.3) 100%);
            z-index: 1;
        }

        /* 3. WAVES */
        .waves-container {
            position: absolute;
            top: 75%;
            left: 0;
            width: 100%;
            height: 10%;
            z-index: 2;
            transform: translateY(-50%);
        }
        
        .wave-svg {
            position: absolute;
            width: 200%;
            height: 100%;
            background-repeat: repeat-x;
            background-position: 0 bottom;
            transform-origin: center bottom;
        }
        
        .wave1 {
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 800 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath fill='rgba(255, 255, 255, 0.3)' d='M0 50 Q 200 100 400 50 T 800 50 V 100 H 0 Z' /%3E%3C/svg%3E");
            animation: wave-anim 12s linear infinite;
            bottom: 10px;
            z-index: 2;
        }
        
        .wave2 {
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 800 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath fill='rgba(255, 255, 255, 0.5)' d='M0 60 Q 150 20 300 60 T 600 60 T 900 60 V 100 H 0 Z' /%3E%3C/svg%3E");
            animation: wave-anim 8s linear infinite reverse;
            bottom: 0;
            z-index: 3;
        }

        @keyframes wave-anim {
            0% { transform: translateX(0); }
            100% { transform: translateX(-50%); }
        }

        /* 4. SAND */
        .sand {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 25%;
            background: linear-gradient(to bottom, #fde68a 0%, #d4d4d8 100%);
            z-index: 2;
        }
        .sand::before {
            content: "";
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            opacity: 0.15;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
        }

        /* 5. PALM TREES */
        .palm-foreground {
            position: absolute;
            bottom: -20px;
            right: -20px;
            width: 400px;
            height: 500px;
            z-index: 3;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 500 600'%3E%3Cpath d='M400 600 Q 380 400 420 250 L 430 250 Q 390 400 440 600 Z' fill='%233f2e18'/%3E%3Cg fill='%2314532d' opacity='0.9'%3E%3Cpath d='M425 250 Q 300 200 250 280 Q 320 220 425 250 Z'/%3E%3Cpath d='M425 250 Q 350 100 280 150 Q 360 150 425 250 Z'/%3E%3Cpath d='M425 250 Q 450 50 520 100 Q 480 150 425 250 Z'/%3E%3Cpath d='M425 250 Q 550 150 600 220 Q 520 220 425 250 Z'/%3E%3Cpath d='M425 250 Q 580 300 550 380 Q 500 300 425 250 Z'/%3E%3C/g%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: bottom right;
            background-size: contain;
            filter: drop-shadow(5px 5px 5px rgba(0,0,0,0.3));
            pointer-events: none;
        }
        
        .palm-left-small {
            position: absolute;
            bottom: 0;
            left: -30px;
            width: 200px;
            height: 250px;
            z-index: 3;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 500 600'%3E%3Cpath d='M100 600 Q 120 400 80 250 L 70 250 Q 110 400 60 600 Z' fill='%234a3720'/%3E%3Cg fill='%2315803d' opacity='0.8'%3E%3Cpath d='M75 250 Q 200 200 250 280 Q 180 220 75 250 Z'/%3E%3Cpath d='M75 250 Q 150 100 220 150 Q 140 150 75 250 Z'/%3E%3Cpath d='M75 250 Q 50 50 -20 100 Q 20 150 75 250 Z'/%3E%3C/g%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: bottom left;
            background-size: contain;
            filter: blur(1px);
            pointer-events: none;
        }

        /* --- UI UTILITIES --- */
        .hidden-screen { display: none !important; }
        .pulse-anim { animation: pulse-red 2s infinite; }
        @keyframes pulse-red {
            0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); }
            70% { box-shadow: 0 0 0 20px rgba(239, 68, 68, 0); }
            100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); }
        }
        .bar-transition { transition: width 0.5s ease-in-out, background-color 0.5s ease; }
        .radio-label input:checked + div {
            background-color: #3b82f6;
            color: white;
            border-color: #3b82f6;
        }
    </style>
</head>
<body class="text-gray-800 h-screen flex flex-col items-center justify-center">

    <!-- REALISTIC BACKGROUND LAYERS -->
    <div class="scene-container">
        <div class="sky">
            <div class="sun"></div>
            <div class="cloud" style="width: 120px; height: 40px; top: 10%; left: -10%;"></div>
            <div class="cloud" style="width: 180px; height: 50px; top: 25%; left: -30%; animation-duration: 80s;"></div>
            <div class="cloud" style="width: 100px; height: 30px; top: 40%; left: -20%; animation-duration: 50s;"></div>
        </div>
        <div class="sea"></div>
        <div class="waves-container">
            <div class="wave-svg wave1"></div>
            <div class="wave-svg wave2"></div>
        </div>
        <div class="sand"></div>
        <div class="palm-foreground"></div>
        <div class="palm-left-small"></div>
    </div>

    <!-- MAIN APP WRAPPER (Single Card Layout) -->
    <div class="w-full max-w-xs mx-4 bg-white/30 backdrop-blur-xl rounded-2xl shadow-[0_20px_60px_rgba(0,0,0,0.5)] overflow-hidden flex flex-col max-h-[90vh] relative z-20 border border-white/40 ring-1 ring-white/50">
        
        <!-- HEADER (Integrated) -->
        <div class="bg-green-600/85 text-white p-4 shrink-0 relative z-10 backdrop-blur-sm">
            <div class="relative flex items-center justify-center mb-1">
                <h1 class="text-xl font-extrabold flex items-center gap-2 drop-shadow-md tracking-wider uppercase text-center">
                    <svg id="header-icon" class="w-6 h-6 shrink-0 filter drop-shadow-sm" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path></svg>
                    <span id="header-title">–°–æ—Ü–∏–∞–ª–µ–Ω –∫–æ–º–ø–∞—Å</span>
                </h1>
                <div id="connection-status" class="w-2.5 h-2.5 rounded-full bg-green-300 animate-pulse absolute right-0 top-1/2 transform -translate-y-1/2 shadow-[0_0_10px_#4ade80]" title="–ê–∫—Ç–∏–≤–µ–Ω –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥"></div>
            </div>
            
            <div id="motto-container" class="hidden text-center text-lg font-bold tracking-wide h-8 overflow-hidden relative drop-shadow-md mt-1 text-white/90">
                <p id="motto-display" class="transition-opacity duration-500">...</p>
            </div>
        </div>

        <!-- CONTENT AREA (Scrollable) -->
        <div class="flex-grow overflow-y-auto p-4 relative bg-transparent">
            
            <!-- VIEW 1: START SCREEN -->
            <div id="start-view" class="flex flex-col items-center justify-center h-full text-center space-y-6 py-4">
                <svg class="w-28 h-28 animate-bounce drop-shadow-2xl" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
                  <defs>
                    <linearGradient id="grad1" x1="0%" y1="0%" x2="100%" y2="100%">
                      <stop offset="0%" style="stop-color:#22c55e;stop-opacity:1" />
                      <stop offset="100%" style="stop-color:#15803d;stop-opacity:1" />
                    </linearGradient>
                  </defs>
                  <circle cx="256" cy="256" r="240" fill="#f0fdf4" stroke="#22c55e" stroke-width="20"/>
                  <path d="M256 40 V80 M256 432 V472 M472 256 H432 M80 256 H40" stroke="#22c55e" stroke-width="20" stroke-linecap="round"/>
                  <circle cx="256" cy="256" r="40" fill="#15803d"/>
                  <polygon points="256,110 290,256 256,256" fill="#22c55e"/>
                  <polygon points="256,110 222,256 256,256" fill="#166534"/>
                  <polygon points="256,402 290,256 256,256" fill="#cbd5e1"/>
                  <polygon points="256,402 222,256 256,256" fill="#94a3b8"/>
                </svg>

                <h2 class="text-base font-bold text-green-900 leading-tight drop-shadow-sm bg-white/40 p-2 rounded-lg backdrop-blur-sm border border-white/30">–ò–Ω—Ç–µ—Ä–¥–∏—Å—Ü–∏–ø–ª–∏–Ω–∞—Ä–µ–Ω –ø—Ä–æ–µ–∫—Ç –∑–∞ –¥–∏–≥–∏—Ç–∞–ª–µ–Ω –∫–æ–º—Ñ–æ—Ä—Ç</h2>
                
                <button onclick="startApp()" class="w-full bg-green-600/90 hover:bg-green-700 text-white font-bold py-4 px-8 rounded-xl shadow-xl transform transition hover:scale-105 active:scale-95 border-b-4 border-green-800 backdrop-blur-sm">
                    –°–¢–ê–†–¢
                </button>
            </div>

            <!-- VIEW 2: DASHBOARD (Hidden initially) -->
            <div id="dashboard" class="space-y-4 hidden-screen">
                
                <!-- TIMERS CARD -->
                <div class="bg-white/60 rounded-xl shadow-sm p-4 text-center border-t-4 border-green-500 backdrop-blur-md">
                    <p class="text-gray-600 text-xs uppercase tracking-wide font-bold">–í—Ä–µ–º–µ –ø—Ä–µ–¥ –µ–∫—Ä–∞–Ω–∞</p>
                    
                    <div class="text-4xl font-bold text-gray-800 mt-2 mb-2 font-mono tracking-wider" id="main-timer">00:00:00</div>
                    
                    <div class="w-full bg-gray-200/60 rounded-full h-2 mb-3 overflow-hidden shadow-inner border border-white/30">
                        <div id="timer-progress" class="bg-green-500/90 h-2 rounded-full transition-all duration-1000 ease-linear" style="width: 0%"></div>
                    </div>

                    <div class="grid grid-cols-2 gap-4 text-xs text-gray-600 border-t border-gray-300/50 pt-2 mt-1">
                        <div class="flex flex-col">
                            <span class="uppercase text-[10px]">–°—Ç–∞—Ç—É—Å</span>
                            <span id="timer-status" class="font-mono text-base text-green-700 font-bold">–ê–∫—Ç–∏–≤–µ–Ω</span>
                        </div>
                        <div class="flex flex-col border-l border-gray-300/50 pl-4">
                            <span class="uppercase text-[10px]">–ê–ª–∞—Ä–º–∞ —Å–ª–µ–¥</span>
                            <span class="font-mono text-base text-red-600 font-bold"><span id="time-remaining">45</span> –º–∏–Ω</span>
                        </div>
                    </div>
                </div>

                <!-- HORMONES CARD -->
                <div class="bg-white/60 rounded-xl shadow-sm p-4 space-y-3 backdrop-blur-md">
                    <h3 class="font-bold text-gray-700 text-center mb-1 flex items-center justify-center gap-2 text-sm">
                        üß¨ –•–æ—Ä–º–æ–Ω–∞–ª–µ–Ω –±–∞–ª–∞–Ω—Å
                    </h3>
                    
                    <!-- Cortisol -->
                    <div>
                        <div class="flex justify-between text-xs mb-1">
                            <span class="font-medium text-gray-700">–ö–æ—Ä—Ç–∏–∑–æ–ª (–°—Ç—Ä–µ—Å)</span>
                            <span id="cortisol-val" class="font-bold text-gray-800">0</span>
                        </div>
                        <div class="w-full bg-gray-200/60 rounded-full h-2.5 overflow-hidden border border-white/30">
                            <div id="cortisol-bar" class="bg-red-500/90 h-2.5 rounded-full bar-transition" style="width: 0%"></div>
                        </div>
                    </div>

                    <!-- Endorphins -->
                    <div>
                        <div class="flex justify-between text-xs mb-1">
                            <span class="font-medium text-gray-700">–ï–Ω–¥–æ—Ä—Ñ–∏–Ω–∏ (–©–∞—Å—Ç–∏–µ)</span>
                            <span id="endorphin-val" class="font-bold text-gray-800">0</span>
                        </div>
                        <div class="w-full bg-gray-200/60 rounded-full h-2.5 overflow-hidden border border-white/30">
                            <div id="endorphin-bar" class="bg-green-500/90 h-2.5 rounded-full bar-transition" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <!-- --- MODALS --- -->

    <!-- ALARM MODAL -->
    <div id="alarm-modal" class="fixed inset-0 bg-red-900/40 backdrop-blur-sm z-50 hidden-screen flex items-center justify-center p-4">
        <div class="bg-white/70 backdrop-blur-xl rounded-xl p-8 max-w-sm w-full text-center shadow-2xl pulse-anim relative border border-white/60">
            <div class="text-6xl mb-4">üö®</div>
            <h2 class="text-3xl font-bold text-red-600 mb-2 uppercase drop-shadow-sm">–ö–†–£–ó–û –ê–õ–ê–†–ú!</h2>
            <p class="text-gray-800 mb-6 font-medium">–í—Ä–µ–º–µ –µ –∑–∞ —Ä–∞–∑–¥–≤–∏–∂–≤–∞–Ω–µ –∏ –æ—Å–≤–µ–∂–∞–≤–∞–Ω–µ.</p>
            
            <div class="bg-white/50 p-4 rounded-lg mb-6 border border-white/50 shadow-inner">
                <p class="text-xs text-gray-600 uppercase mb-1 font-bold">–í–∞—à–∞—Ç–∞ –º–∏—Å–∏—è:</p>
                <p id="alarm-mission-title" class="text-xl font-bold text-green-700">–ó–∞—Ä–µ–∂–¥–∞–Ω–µ...</p>
                <p id="alarm-mission-instr" class="text-sm text-gray-800 mt-2 font-medium">...</p>
            </div>
            
            <div class="space-y-3">
                <button onclick="completeMission()" class="w-full bg-green-600/90 hover:bg-green-700 text-white font-bold py-3 px-4 rounded-lg shadow-lg backdrop-blur-sm">
                    ‚úÖ –ò–∑–ø—ä–ª–Ω–∏—Ö –ú–∏—Å–∏—è—Ç–∞!
                </button>
                <button onclick="refuseMission()" class="w-full bg-white/50 hover:bg-white/70 text-gray-800 font-semibold py-3 px-4 rounded-lg border border-gray-300">
                    ‚õî –û—Ç–∫–∞–∑–≤–∞–º
                </button>
            </div>
        </div>
    </div>

    <!-- BRAVO MODAL -->
    <div id="bravo-modal" class="fixed inset-0 bg-green-600/30 backdrop-blur-sm z-[60] hidden-screen flex items-center justify-center p-4">
        <div class="bg-white/70 backdrop-blur-xl rounded-xl p-8 max-w-sm w-full text-center shadow-2xl border border-white/60">
            <div class="text-6xl mb-4">üèÜ</div>
            <h2 class="text-2xl font-bold text-green-700 mb-2 drop-shadow-sm">–ë—Ä–∞–≤–æ, –ö–æ—Ä–∞–±–æ–∫—Ä—É—à–µ–Ω–µ—Ü–æ!</h2>
            <p class="text-gray-800 mb-6 font-medium">–£—Å–ø–µ—à–Ω–æ –±–∞–ª–∞–Ω—Å–∏—Ä–∞—Ö—Ç–µ –¥–∏–≥–∏—Ç–∞–ª–Ω–∏—è –∏ —Ä–µ–∞–ª–Ω–∏—è —Å–≤—è—Ç.</p>
            
            <div class="flex justify-center gap-4 mb-6 text-sm font-bold">
                <span class="text-red-600 bg-red-100/60 px-3 py-1 rounded border border-red-200">–ö–æ—Ä—Ç–∏–∑–æ–ª -15</span>
                <span class="text-green-700 bg-green-100/60 px-3 py-1 rounded border border-green-200">–ï–Ω–¥–æ—Ä—Ñ–∏–Ω–∏ +20</span>
            </div>

            <button onclick="resetApp()" class="w-full bg-green-600/90 text-white font-bold py-3 rounded-lg hover:bg-green-700 shadow-lg backdrop-blur-sm">
                –ü—Ä–æ–¥—ä–ª–∂–∏ –Ω–∞–ø—Ä–µ–¥
            </button>
        </div>
    </div>

    <!-- ETHICAL FILTER -->
    <div id="ethical-modal" class="fixed inset-0 bg-gray-900/40 backdrop-blur-sm z-50 hidden-screen flex items-center justify-center px-4">
        <div class="bg-white/75 backdrop-blur-xl rounded-xl p-3 max-w-sm w-full shadow-2xl flex flex-col max-h-[95vh] border border-white/60">
            <div class="shrink-0">
                <h3 class="text-lg font-bold text-gray-800 mb-1">‚öñÔ∏è –ï—Ç–∏—á–µ–Ω —Ñ–∏–ª—Ç—ä—Ä</h3>
                <p class="text-xs text-gray-600 mb-2 border-b border-gray-300/50 pb-1">–û—Ç–≥–æ–≤–æ—Ä–µ—Ç–µ —á–µ—Å—Ç–Ω–æ –∑–∞ –¥–∞ –ø—Ä–æ–¥—ä–ª–∂–∏—Ç–µ.</p>
            </div>
            
            <form id="ethical-form" onsubmit="event.preventDefault(); processEthicalFilter();" class="flex flex-col min-h-0">
                <div class="flex-grow overflow-y-auto space-y-2 pr-1" id="questions-container">
                    <!-- Questions injected by JS -->
                </div>
                
                <div class="shrink-0 pt-3">
                    <div id="form-error" class="text-red-600 text-[10px] text-center mb-1 hidden font-bold">–ú–æ–ª—è, –æ—Ç–≥–æ–≤–æ—Ä–µ—Ç–µ –Ω–∞ –≤—Å–∏—á–∫–∏ –≤—ä–ø—Ä–æ—Å–∏!</div>
                    <button type="submit" class="w-full bg-blue-600/90 hover:bg-blue-700 text-white font-bold py-2 rounded-lg transition shadow-md text-sm backdrop-blur-sm">
                        –ò–∑–ø—Ä–∞—Ç–∏ –æ—Ç–≥–æ–≤–æ—Ä–∏
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- CRISIS CONTACTS -->
    <div id="crisis-modal" class="fixed inset-0 bg-red-950/80 backdrop-blur-md z-[70] hidden-screen flex flex-col items-center justify-center p-6 text-center text-white">
        <div class="mb-6 text-6xl animate-pulse">üÜò</div>
        <h2 class="text-2xl font-bold text-red-400 mb-2 uppercase drop-shadow-md">–ö—Ä–∏—Ç–∏—á–Ω–æ –Ω–∞—Å–æ—á–≤–∞–Ω–µ</h2>
        <h3 class="text-xl text-white mb-6 font-light">–°–ª—É—á–∞–π "–ê–¥–∞–º –†–µ–π–Ω" - –í–∏—Å–æ–∫ —Ä–∏—Å–∫</h3>
        
        <div class="w-full max-w-xs bg-white/10 backdrop-blur-md rounded-xl p-6 mb-8 text-left border border-red-500/30 shadow-2xl">
            <div class="mb-6">
                <p class="text-xs uppercase tracking-widest text-red-300 mb-1 font-bold">–ù–∞—Ü–∏–æ–Ω–∞–ª–Ω–∞ –ª–∏–Ω–∏—è –∑–∞ –ø–æ–¥–∫—Ä–µ–ø–∞</p>
                <a href="tel:116111" class="text-3xl font-bold block text-white drop-shadow-sm">üìû 116 111</a>
            </div>
            <div>
                <p class="text-xs uppercase tracking-widest text-red-300 mb-1 font-bold">–ü—Å–∏—Ö–æ—Å–æ—Ü–∏–∞–ª–Ω–∞ –ø–æ–¥–∫—Ä–µ–ø–∞ (–ë–ß–ö)</p>
                <a href="tel:080088001" class="text-2xl font-bold block text-white drop-shadow-sm">üìû 0 800 88 001</a>
            </div>
        </div>

        <button onclick="acknowledgeCrisis()" class="w-full max-w-xs bg-red-700/90 hover:bg-red-600 text-white font-bold py-3 px-6 rounded-lg border border-red-500 shadow-lg backdrop-blur-sm">
            –†–ê–ó–ë–†–ê–•
        </button>
        <p class="text-xs text-gray-300 mt-2">–ù–∞—Ç–∏—Å–∫–∞–Ω–µ—Ç–æ —â–µ –ø—Ä–∏–ª–æ–∂–∏ –Ω–∞–∫–∞–∑–∞–Ω–∏–µ –≤—ä—Ä—Ö—É —Ç–æ—á–∫–∏—Ç–µ.</p>
    </div>

    <!-- JAVASCRIPT LOGIC -->
    <script>
        // CONFIGURATION
        const CONFIG = {
            alarmThresholdMin: 45,
            cortisolStart: 0,
            endorphinStart: 0,
            cortisolTick: 5,     // +5 Cortisol every 5 mins
            
            // Rewards/Penalties
            missionCortisolReward: -15,
            missionEndorphinReward: 20,
            refusalEndorphinPenalty: -20
        };

        const MOTTOS = [
            "–°–ø–∞–∑–≤–∞–π –¥–∏—Å—Ü–∏–ø–ª–∏–Ω–∞", "–ü–æ-–ø—Ä–∏—è—Ç–Ω–æ —Å —á–æ–≤–µ–∫ –¥–æ —Ç–µ–±", "–ß–æ–≤–µ–∫ —Å —á–æ–≤–µ–∫", "–¢—Ä—É–¥—ä—Ç —Å–ø–∞—Å—è–≤–∞", "–í–∏–Ω–∞–≥–∏ –∏–º–∞ –∫–∞–∫"
        ];

        const MISSIONS = [
            { title: "–ö–ª—è–∫–∞–Ω–∏—è", instr: "–ù–∞–ø—Ä–∞–≤–∏ 3 —Å–µ—Ä–∏–∏ –ø–æ 15 –∫–ª—è–∫–∞–Ω–∏—è." },
            { title: "–†–∞–∑—Ö–æ–¥–∫–∞", instr: "5 –º–∏–Ω—É—Ç–∏ –±—ä—Ä–∑–∞ —Ä–∞–∑—Ö–æ–¥–∫–∞ –∏–∑ —Å—Ç–∞—è—Ç–∞." },
            { title: "–ì–∏–º–Ω–∞—Å—Ç–∏–∫–∞", instr: "10 –∫—Ä—ä–≥–æ–≤–∏ –¥–≤–∏–∂–µ–Ω–∏—è —Å —Ä—ä—Ü–µ." },
            { title: "–ì—Ä–µ–±–∞–Ω–µ", instr: "20 –ø–æ–≤–¥–∏–≥–∞–Ω–∏—è –Ω–∞ –∫–æ–ª–µ–Ω–µ—Ç–µ –∫—ä–º –≥—ä—Ä–¥–∏—Ç–µ." }
        ];

        // 6 ETHICAL QUESTIONS
        const ETHICAL_QUESTIONS = [
            "–ü—Ä–µ–¥–ø–æ—á–∏—Ç–∞—Ç–µ –ª–∏ AI –ø—Ä–µ–¥ —Ö–æ—Ä–∞?",
            "–ü—Ä–æ–ø—É—Å–∫–∞—Ç–µ –ª–∏ —Ö—Ä–∞–Ω–µ–Ω–µ –∑–∞—Ä–∞–¥–∏ –µ–∫—Ä–∞–Ω–∞?",
            "–ù–∞–º–∏—Ä–∞—Ç–µ –ª–∏ —É—Ç–µ—Ö–∞ —Å–∞–º–æ –æ–Ω–ª–∞–π–Ω?",
            "–ö—Ä–∏–µ—Ç–µ –ª–∏ –∫–æ–ª–∫–æ –≤—Ä–µ–º–µ —Å—Ç–µ –æ–Ω–ª–∞–π–Ω?",
            "–ò–∑–ø–∏—Ç–≤–∞—Ç–µ –ª–∏ —Ç—Ä–µ–≤–æ–∂–Ω–æ—Å—Ç –±–µ–∑ —Ç–µ–ª–µ—Ñ–æ–Ω?",
            "–ì—É–±–∏—Ç–µ –ª–∏ —Å—ä–Ω –∑–∞—Ä–∞–¥–∏ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç?"
        ];

        // STATE
        let state = {
            startTime: null,
            timerRunning: false,
            lastHormoneUpdate: null,
            cortisol: CONFIG.cortisolStart,
            endorphins: CONFIG.endorphinStart,
            timerInterval: null,
            activeMission: null,
            elapsedPaused: 0 // Track time when paused
        };

        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

        // --- APP START & TIMER ---
        
        function startApp() {
            document.getElementById('start-view').classList.add('hidden-screen');
            document.getElementById('dashboard').classList.remove('hidden-screen');
            
            // Show Mottos only after start
            document.getElementById('motto-container').classList.remove('hidden');
            
            // UPDATE HEADER FOR TIMER MODE
            // Hide icon
            document.getElementById('header-icon').classList.add('hidden');
            // Change text to "–ù–∞–≤–∏–≥–∞—Ç–æ—Ä –Ω–∞ –ö—Ä—É–∑–æ"
            document.getElementById('header-title').textContent = "–ù–∞–≤–∏–≥–∞—Ç–æ—Ä –Ω–∞ –ö—Ä—É–∑–æ";

            rotateMottos();

            if (audioCtx.state === 'suspended') audioCtx.resume();

            resetLogicState();
            startTimer();
            updateHormonesUI();
        }

        function resetLogicState() {
            state.cortisol = CONFIG.cortisolStart;
            state.endorphins = CONFIG.endorphinStart;
            state.elapsedPaused = 0;
            state.timerRunning = false;
            clearInterval(state.timerInterval);
            
            // Reset Progress Bar
            const pb = document.getElementById('timer-progress');
            pb.style.width = '0%';
            pb.className = "bg-green-500 h-1.5 rounded-full transition-all duration-1000 ease-linear";
        }

        function startTimer() {
            state.startTime = Date.now();
            state.lastHormoneUpdate = Date.now();
            state.timerRunning = true;
            
            document.getElementById('timer-status').textContent = "–ê–∫—Ç–∏–≤–µ–Ω";
            document.getElementById('timer-status').className = "font-mono text-base text-green-600"; 

            state.timerInterval = setInterval(gameLoop, 1000);
        }

        function stopTimer() {
            state.timerRunning = false;
            clearInterval(state.timerInterval);
            document.getElementById('timer-status').textContent = "–ü–ê–£–ó–ê";
            document.getElementById('timer-status').className = "font-mono text-base text-red-600 animate-pulse";
        }

        // --- LOOP ---
        function gameLoop() {
            if (!state.timerRunning) return;

            const now = Date.now();
            const sessionElapsed = now - state.startTime; // ms
            
            // 1. Update UI Timer
            document.getElementById('main-timer').textContent = formatTime(sessionElapsed);

            // 2. Alarm Countdown
            const totalDuration = CONFIG.alarmThresholdMin * 60 * 1000;
            const remainingSec = (CONFIG.alarmThresholdMin * 60) - Math.floor(sessionElapsed / 1000);
            const remainingMin = Math.ceil(remainingSec / 60);
            document.getElementById('time-remaining').textContent = remainingMin > 0 ? remainingMin : 0;

            // 3. Update Progress Bar
            const progress = Math.min(100, (sessionElapsed / totalDuration) * 100);
            const progressBar = document.getElementById('timer-progress');
            progressBar.style.width = progress + '%';

            // Change color based on progress (Green -> Yellow -> Red)
            if (progress > 85) progressBar.className = "bg-red-500 h-1.5 rounded-full transition-all duration-1000 ease-linear";
            else if (progress > 50) progressBar.className = "bg-yellow-500 h-1.5 rounded-full transition-all duration-1000 ease-linear";
            else progressBar.className = "bg-green-500 h-1.5 rounded-full transition-all duration-1000 ease-linear";

            // 4. Hormone Auto-Increase (+5 Cortisol every 5 mins)
            // RESTORED: 300,000 ms (5 minutes)
            if (now - state.lastHormoneUpdate >= 300000) { 
                updateHormones(CONFIG.cortisolTick, 0); 
                state.lastHormoneUpdate = now;
            }

            // 5. Trigger Alarm
            if (sessionElapsed >= totalDuration) {
                triggerAlarm();
            }
        }

        // --- ALARM LOGIC ---
        function triggerAlarm() {
            stopTimer(); // Requirement: Timer stops automatically
            playAlarmSound();
            
            // Pick random mission
            state.activeMission = MISSIONS[Math.floor(Math.random() * MISSIONS.length)];
            document.getElementById('alarm-mission-title').textContent = state.activeMission.title;
            document.getElementById('alarm-mission-instr').textContent = state.activeMission.instr;

            document.getElementById('alarm-modal').classList.remove('hidden-screen');
        }

        // --- PATH 1: MISSION COMPLETE ---
        function completeMission() {
            document.getElementById('alarm-modal').classList.add('hidden-screen');
            
            // Logic: Cortisol -15, Endorphin +20
            updateHormones(CONFIG.missionCortisolReward, CONFIG.missionEndorphinReward);

            // Show Bravo Modal
            document.getElementById('bravo-modal').classList.remove('hidden-screen');
        }

        // Reset called from Bravo modal
        function resetApp() {
            document.getElementById('bravo-modal').classList.add('hidden-screen');
            // Reset timer, keep hormone values
            startTimer();
            // Note: startTimer resets startTime, so progress bar will naturally drop to 0 in next gameLoop
        }

        // --- PATH 2: REFUSE MISSION (Ethical Filter) ---
        function refuseMission() {
            document.getElementById('alarm-modal').classList.add('hidden-screen');
            renderEthicalQuestions();
            document.getElementById('ethical-modal').classList.remove('hidden-screen');
        }

        // --- ETHICAL FILTER LOGIC (UPDATED for Compactness) ---
        function renderEthicalQuestions() {
            const container = document.getElementById('questions-container');
            container.innerHTML = '';
            
            // Use flex column for compact stacking
            container.className = "flex flex-col gap-2";

            ETHICAL_QUESTIONS.forEach((q, index) => {
                const html = `
                    <div class="flex items-center justify-between bg-white/60 p-2 rounded border border-gray-200">
                        <p class="text-xs font-medium mr-2 text-gray-800 leading-tight">${q}</p>
                        <div class="flex shrink-0">
                            <label class="cursor-pointer radio-label">
                                <input type="radio" name="q${index}" value="yes" class="hidden">
                                <div class="px-3 py-1 border-y border-l border-gray-300 rounded-l text-[10px] font-bold transition hover:bg-gray-200">–î–ê</div>
                            </label>
                            <label class="cursor-pointer radio-label">
                                <input type="radio" name="q${index}" value="no" class="hidden">
                                <div class="px-3 py-1 border border-gray-300 rounded-r text-[10px] font-bold transition hover:bg-gray-200">–ù–ï</div>
                            </label>
                        </div>
                    </div>
                `;
                container.innerHTML += html;
            });
        }

        function processEthicalFilter() {
            // Validation
            const formData = new FormData(document.getElementById('ethical-form'));
            let yesCount = 0;
            let answeredCount = 0;

            // Check answers for all 6 questions (q0 to q5)
            for(let i=0; i<ETHICAL_QUESTIONS.length; i++) {
                const val = formData.get(`q${i}`);
                if(!val) {
                    document.getElementById('form-error').classList.remove('hidden');
                    return;
                }
                if(val === 'yes') yesCount++;
                answeredCount++;
            }

            document.getElementById('form-error').classList.add('hidden');
            document.getElementById('ethical-modal').classList.add('hidden-screen');

            // RISK LOGIC
            if (yesCount >= 3) {
                // HIGH RISK -> Crisis Screen
                document.getElementById('crisis-modal').classList.remove('hidden-screen');
            } else {
                // LOW RISK -> Penalty & Restart
                applyPenaltyAndRestart();
            }
        }

        function acknowledgeCrisis() {
            document.getElementById('crisis-modal').classList.add('hidden-screen');
            applyPenaltyAndRestart();
        }

        function applyPenaltyAndRestart() {
            // Penalty: Endorphins -20, Cortisol unchanged
            updateHormones(0, CONFIG.refusalEndorphinPenalty);
            
            // Immediate Reset (No confirmation modal)
            startTimer();
        }

        // --- HELPERS ---
        function updateHormones(cortChange, endoChange) {
            state.cortisol = Math.max(0, state.cortisol + cortChange);
            state.endorphins = Math.max(0, state.endorphins + endoChange);
            updateHormonesUI();
        }

        function updateHormonesUI() {
            const cBar = document.getElementById('cortisol-bar');
            const eBar = document.getElementById('endorphin-bar');
            
            // UI Max logic: if > 100, bar is full (100%), but text shows real number
            const cPct = Math.min(100, state.cortisol);
            const ePct = Math.min(100, state.endorphins);

            cBar.style.width = cPct + '%';
            document.getElementById('cortisol-val').textContent = state.cortisol;
            
            eBar.style.width = ePct + '%';
            document.getElementById('endorphin-val').textContent = state.endorphins;
        }

        function formatTime(ms) {
            const totalSec = Math.floor(ms / 1000);
            const h = Math.floor(totalSec / 3600).toString().padStart(2, '0');
            const m = Math.floor((totalSec % 3600) / 60).toString().padStart(2, '0');
            const s = (totalSec % 60).toString().padStart(2, '0');
            return `${h}:${m}:${s}`;
        }

        function rotateMottos() {
            const display = document.getElementById('motto-display');
            let index = 0;
            display.textContent = MOTTOS[0];
            setInterval(() => {
                index = (index + 1) % MOTTOS.length;
                display.style.opacity = 0;
                setTimeout(() => {
                    display.textContent = MOTTOS[index];
                    display.style.opacity = 1;
                }, 500);
            }, 5000);
        }

        function playAlarmSound() {
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            
            osc.frequency.setValueAtTime(440, audioCtx.currentTime);
            osc.frequency.linearRampToValueAtTime(880, audioCtx.currentTime + 0.5);
            
            gain.gain.setValueAtTime(0.5, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);
            
            osc.start();
            osc.stop(audioCtx.currentTime + 0.5);
        }

        // --- SERVICE WORKER REGISTRATION (PWA) ---
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then(reg => console.log('SW —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–∞–Ω!', reg))
                    .catch(err => console.log('SW –≥—Ä–µ—à–∫–∞:', err));
            });
        }
    </script>
</body>
</html>
